# docker-compose.yml
version: "3.8"

services:
  virusgame:
    # The image tag will be replaced by the GitHub Actions workflow
    image: ghcr.io/korjavin/virusgame:7301566c3f772610738408782a2eecfb470b238a
    container_name: virusgame
    networks:
      - net1
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.virusgame.rule=Host(`${HOSTNAME}`)"
      - "traefik.http.routers.virusgame.entrypoints=websecure"
      - "traefik.http.routers.virusgame.tls.certresolver=myresolver"
      # WebSocket support
      - "traefik.http.services.virusgame.loadbalancer.server.port=8080"
      - "traefik.http.middlewares.virusgame-ws.headers.customrequestheaders.Connection=upgrade"
      - "traefik.http.middlewares.virusgame-ws.headers.customrequestheaders.Upgrade=websocket"
      - "traefik.http.routers.virusgame.middlewares=virusgame-ws"
    restart: unless-stopped

networks:
  net1:
    external: true
    name: ${NETWORK_NAME}
